<?php
//Izvada marķētos tvītus, atkarībā no parametra type:
//	get-annotated.php?type=poz - visi pozitīvie teksta formā
//	get-annotated.php?type=nei - visi neitrālie teksta formā
//	get-annotated.php?type=neg - visi negatīvie teksta formā
//
//	get-annotated.php?set=train - apmācības dati JSON formā
//	get-annotated.php?set=test - vērtēšanas dati JSON formā
//
//	get-annotated.php?set=train&compact - apmācības dati kompaktā JSON formā
//	get-annotated.php?set=test&compact - vērtēšanas dati kompaktā JSON formā

//Pieslēgums DB
include "../includes/init_sql.php";

//Datumam jābūt 2020-04-30 vai vēlākam

if(isset($_GET['set'])){
	//test or train
	$set = $_GET['set'];
}else{
	$set = 'train';
}

//Vērtēšanas kopas ID
$testIDs = array('1259773105888808960','1259770581328764929','1256958121160949761','1256963181274169347','1259198927045361664','1259955809540354052','1257013157291319298','1260604695845969920','1260174038334410752','1260172545078239233','1260171126094868481','1260170668634759168','1260169716141887488','1260168291777220608','1260169633631555586','1260168059295326208','1259768328526204928','1259148349367869440','1259764031851769856','1257011148408467457','1258417005679566851','1258404676208398336','1258416715656048642','1258416984804528128','1258416307260862470','1258412898658942976','1259397790804905984','1258798965228802050','1258411422175973377','1258402356762488832','1258398471981281281','1258392457403936769','1258390564485070849','1258389162325090305','1258387300892979201','1258384841281802246','1258381155998609413','1258378565629943808','1258380180214685696','1258371170489032710','1258376568054919168','1258373153887268866','1258365655268708355','1258370147796094976','1258365246965678080','1258364593660887041','1258362423884615680','1258361590283370497','1257000699319238659','1256994161028407297','1256988054235025410','1256987694200168451','1256978127433105408','1256983620125892610','1256977088265039873','1256975334999764992','1256969616087285761','1256219650628747265','1256951859828396033','1256322501665099776','1256318467378053121','1256304856257748992','1259185580447014914','1259185994802364420','1257703399245545479','1257704923535495182','1257707348040257538','1257735895022800908','1257734584936128513','1259178995314307072','1259178425857736711','1259175320118341632','1259175090375229446','1260168046100054016','1256310467833655296','1258763086581899264','1258763359018725376','1258795010494996482','1258793360476844037','1258789548412329984','1258777744567123970','1258773092916174849','1258775941872070656','1258768704722161665','1257724377078128643','1257687561222438915','1257687375385419778','1257680434600820738','1257680085265592322','1258758728716824576','1258747257735852032','1258715993649577988','1258721494219227136','1260166482425786368','1260163331052179458','1260155694319390721','1260157563385110529','1260164322828967937','1260163964836753410','1260601192905916416','1260592625024892928','1260592377431015425','1260587548990210048','1256301668284628993','1256299645141221378','1256292630754885632','1256276666915176457','1256275133100167168','1256256717337362433','1256237776590299136','1256126068320350209','1256126386621857793','1259167171437043712','1259165162562609154','1260588374152425473','1260583095893463041','1260580217208307716','1260579890694361090','1260570081618264069','1260573252000325634','1260573236900888578','1256197624648142848','1256215818519687171','1258359084992135173','1260558543628967940','1260560487768625153','1260535589566324736','1260544610612523009','1260532926648909830','1260525678157496321','1260527261398323200','1260532716728209409','1260518448175685632','1260517242866991104','1260437042149969926','1260511512738902022','1257403076882894850','1257403140409868289','1260506910031327234','1260505390158053376','1256947224040345601','1256943431601045505','1256934186214133762','1256937275788873729','1256928953597661184','1256914159092015104','1256906350954778625','1256891338504769537','1256881816037986304','1256183026435993602','1256182703080300544','1256181834934816769','1256180115538612231','1256172199410642944','1256168583597568001','1256158941295325184','1256150891482185730','1256149325559861248','1256147379516047361','1256137850468343808','1256106755504955394','1256118053466669056','1256118085339222016','1256119445098987521','1260495671695683585','1260161712533188608','1260160282363600896','1260488169067368448','1260486064092975104','1260468192297787394','1258742516767232001','1258736647476260864','1258732424541999104','1258731274484756482','1257668535859412992','1257651693979869184','1257650217307996160','1257649083281530880','1257648850686353414','1257648418341687296','1257645735660736515','1257646185348808705','1257644397048578050','1257644205717012481','1257643497169059844','1257644177539596289','1257409186486312960','1257405928367886336','1257995408703393792','1259147547970543616','1258711830488326144','1258354197503840258','1258353191734968322','1258349692343267328','1258015274432954379','1258013457984733184','1258010800394043393','1258000004951744513','1257996524019167232','1257996363675172864','1257642751396544512','1257641975492329472','1257642157801910274','1257632682076442624','1257639842671996929','1257625904718712833','1257627072941391884','1258695440876404736','1258692610006360064','1258690310185639938','1258686115105705985','1258685304443146240','1258682905167044609','1258672332119343104','1258656850305835010','1258629023749623814','1260479348034977792','1260479543833485313','1260480199797420032','1260472806472589316','1260153599025438720','1260462488421904384','1260466497513754631','1260459655953858562','1260151295815581697','1260149129839288320','1260146726490472453','1259753860312244224','1259750640726794240','1259748505280798720','1259748492379148288','1259748277945335808','1259745505426444289','1260136808714829824','1260133936589606912','1260135167701680128','1260133386460573697','1260131881309388801','1260130287360651264','1260127271802863617','1260127805528068097','1260121847338852354','1260122840856170507','1260124657266679808','1260128432316391424','1260119393574551552','1260109651347148800','1260119119850090496','1260104711035932672','1260099702076387329','1260099964077854720','1262356976585134080','1262344441928585217','1262319233247182848','1262309955891232768','1262308368372424704','1262309528995016705','1259135263361679361','1259132106225209346','1259120023026761728','1259086494188388353','1259080883220500481','1256089603230044161','1256076801094320129','1256871603931095040','1256871818507534345','1256862759918206982','1256853760481071105','1256841587528740866','1257397008144437249','1257394589314547717','1257393749065416704','1257393625014718464','1257390312114327553','1257389325605625857','1257387762283679744','1257387937446211587','1257612618891759616','1257604069272805376','1257601834073669632','1257583789091500038','1257578712998064131','1257575016125861888','1257573216429707264','1257567153437446146','1257565329007480834','1257562782985265153','1257562637187063809','1257995747859054593','1257986524873973762','1257976143887699969','1257971501451575296','1257969482879963136','1257965429248724993','1257962031606530048','1257959900577173507','1257958000796545024','1257956861816516608','1257957592078389249','1257957774220300290','1257954183774441476','1257952305917329410','1257952597115375621','1257947799813001218','1257935025955377153','1257916026097934336','1257912766293303296','1257900613301649411','1257895674164764673','1258328254949318658','1258323765689188353','1258316013499756550','1258312391772852225','1258308793827569664','1258310543934476289','1258307485955493890','1258304121070850048','1258299745061294080','1258623996179951619','1259071849788592129','1259070489974181889','1259060254463201282','1259049817625497600','1259049724096794624','1259043481638576128','1259034403042398208','1259026614878441472','1259021491775188992','1259020114583859200','1259018343253770243','1259013598082408449','1259012995998519297','1259002453242118144','1258992337704927232','1258875103229739009','1258873908217950209','1259527734088392704','1259527096998727681','1259527161305804808','1259519087245512704','1259519507728601090','1259520831685787649','1259505411738210305','1259514006580219907','1259494805740101632','1259480790548787201','1259467997040828417','1259461422834241537','1259452459992453120','1259430655328428036','1259428006050873344','1259419029418246144','1259424274827395072','1259412106484604929','1259737689227747329','1259733469325910016','1259732921994350592','1259730981340184577','1259729018091384832','1259728118966677505','1259725682176860160','1259724014144163841','1259719560795762695','1259720143921459200','1259702707809640448','1259703519172530176','1259668582482489344','1259618906769182720','1260079473275408384','1260069581051265025','1260069435882209280','1259985507691507712','1259976435869069313','1262296831700205568','1262296194086244352','1262025253989101571','1262020342400286720','1262012556023140354','1259760113797259264','1259374561260339200','1259373360234082304','1259257493257097217','1259251889851555842','1260420711241449472','1259607139460567041','1259604061151809540','1259602348164472833','1259600696107819009','1259595831046475777','1259593549559054336','1259593372005797890','1256011338469556225','1255981583091339268','1255969381231853576','1256839843189055488','1256810178831421441','1256765770933121024','1256702064429858819','1257373828709302274','1257371255004635140','1257369469313331200','1257349301489020928','1257346941853335554','1257341202720047111','1257341686960795653','1257331750444941312','1257331156153970688','1257315598259720192','1257294707216056320','1257285298985340928','1257284588977750016','1257270946387329024','1257268785947578368','1257227565753868289','1257218689247649792','1257214707368329216','1257204180986593280','1257199942705254400','1257178974662295552','1257098389537333262','1257058933321187335','1257056316096380928','1257539113231831040','1257449363393122305','1257449092348874754','1257437805845917697','1257427723145879555','1257425971843600385','1257871089277026304','1257865762284253184','1257840794490339335','1257804318520102914','1257793046361640961','1258293018941145093','1258291172147105803','1258290522470461443','1258285168630136837','1258283798384566274','1258281223115415552','1258166477351464963','1258146729167400962','1258615480673329153','1258547048468475905','1258547272322658305','1258520391850446848','1258511426106167296','1259249708263968780','1259236194132668418','1255966385550868480','1255932404033871877','1255937834466361350','1255941435922288640','1255946285628129285','1255948485062516738','1255950538606288909','1255950947425169410','1255953222855991302','1255956910957887490','1255959161365553152','1255961553653948421','1255963727180042240','1255963858826600448','1257027070527516673','1257029200097271809','1257032741935349773','1257044522590224386','1257047372707909633','1257749949984452616','1257759231069085696','1257772825768865792','1257773258138583042','1258020783504396288','1258027474732101634','1258036093192151040','1258048740058976259','1258076774765924352','1258090871590916100','1258105238743134208','1258105647721254912','1258108404549255169','1258113580886626305','1258116042838204421','1258117213996945408','1258118231266557953','1258120833941352455','1258128639931146240','1258130901701210112','1258131209269530624','1258423101815173120','1258423127991881731','1258423161756008449','1258423329096118272','1258426020820115457','1258429018094911488','1258444761373061120','1258457382990032896','1258464605283725313','1258485123705638912','1258488629413982209','1258488904564563970','1258491009559932928','1258491825721085955','1258497081473466372','1258498754874933249','1258502321459400709','1258801561876287488','1258802354046087169','1258805712286867456','1258807830259343361','1258816055910240257','1258820979901509634','1258823299414581250','1258829201219686400','1258831392181493760','1258832489864466432','1258833712147574784','1258833956293795841','1258857374791720962','1259205296532193281','1259216302297800704','1259216977912004612','1259218153298694149','1259221979846062080','1259226525423087618','1259533335317090312','1259534635266179072','1259538750687924226','1259552839589859328','1259554796710871041','1259558393678888962','1259563464693088268','1259568319369228289','1259571283290882049','1259573636240941060','1259573923882074112','1259576572324933632','1259773545284087808','1259773992862453760','1259774502894002176','1259775705560252419','1259781737321725952','1259792044249231362','1259792252106354688','1259792848855187457','1259792924960792581','1259794277380612096','1259798618988568576','1259798946647506944','1259800313558695938','1259801549024432128','1259804481870536704','1259806826176053249','1259808745217024000','1259815518632128513','1259837492662079494','1259837814134448130','1259838062038781953','1259839681925206018','1259843330587926542','1259845483851382785','1259848344249262082','1259858631882874880','1259878770355421185','1259884484498948097','1259886540974628864','1259894706600804361','1259895029444882437','1259899676565872651','1259903916864606216','1259906889195937792','1259908839182348291','1259913075001622535','1259915179267153921','1259930764986245129','1260180067038232582','1260181408905146368','1260184603085754369','1260192097434570752','1260195900095430656','1260205103002333185','1260206989788971012','1260209709333823490','1260209856319012870','1260211057999708160','1260211383624491008','1260214547518050305','1260215465139372032','1260215572954066944','1260218597558935554','1260225390536208385','1260233336007593984','1260235305342418944','1260239985820786691','1260241301506752514','1260245533916049408','1260248169276944385','1260251680484057088','1260254338339004427','1260254647631130624','1260256832351805445','1260260969739169796','1260261508837187586','1260262100699676675','1260263815704387588','1260264145938776064','1260264722093441030','1260270547184816130','1260276347013935104','1260283291766337540','1260286297073233920','1260287701821030400','1260287839264288769','1260294761283551232','1260297756528332804','1260299996324380673','1260305214319611904','1260307950670958592','1260605353529683968','1260613769954234370','1260616470016466944','1260619174776274951','1260625312645332993','1260627304226664453','1260631202278629378','1260637400381956103','1260637796236169218','1260643181768687616','1260643725606178818','1260644290822193153','1260650701799096320','1260653023631564801','1260659457865834496','1260662483620069377','1260668795510820874','1260669012108771329','1260679840170151936','1260680366337273858','1260683890253070336','1260684958261227521','1260692969369276417','1260714648346787851','1260891639465246720','1260895345627856896','1260896692116824065','1260904055276273664','1260906157734068224','1260908096752439296','1260914785782239234','1260916725001961480','1260918132853690369','1260942713907707904','1260947728093380608','1260961878769119232','1260971554340560901','1260983206360363008','1260996278512693249','1261002787556597762','1261009263658438658','1261012917459324929','1261014585013866496','1261028099526995968','1261034049101070341','1261035309850116097','1261036345830584321','1261332826009501696','1261341418817085442','1261346226038923265','1261361314129014785','1261363526242713600','1261364656251142144','1261373387991105537','1261374130978349056','1261376868319707137','1261380326611283970','1261388855812534275','1261388963308351488','1261637057853771776','1261638164613140480','1261638279218245633','1261638474047815680','1261649054993440769','1261653778358468608','1261657713131560961','1261657978782048257','1261658642425708546','1261659141933797377','1261662589400031232','1261664919772069889','1261672726684749825','1261676144539119616','1261678208136724480','1261680304013492225','1261680835469737984','1261690962478325760','1261692906525593600','1261695472537919488','1261700199770136576','1261708038915981315','1261717524179189760','1261718621786603520','1261718843837341696','1261720890527621120','1261725514433286144','1261729213595504640','1261731024528121857','1261757267046785024','1261758386896539649','1261759102327422976','1261761440492466176','1261762804274651146','1262042281797976066','1262046843141263367','1262050026697773058','1262058180781187072','1262069111640797188','1262076362443173888','1262078583150972928','1262093383398559750','1262094168203165696','1262104415865122818','1262105067055992833','1262115570725654528','1262119052996227072','1262119963986362369','1262123638821662720','1262383091638841354','1262385433582936067','1262385674579251205','1262394869865209856','1262404856930799616','1262413515115167744','1262415287179251714','1262420681540677632','1262430939176734723','1262435828032208897','1262447155119300611','1262449507217727489','1262454202934145027','1262461821384101890','1262463045672058886','1262466967811821571','1262472327780057088','1262476524437016580','1262483350364786690');

if($_GET['type'] == 'nei'){
	$result= mysqli_query($connection, "SELECT id, screen_name, text FROM tweets WHERE emo = 0 AND created_at BETWEEN '2020-04-30 00:00:00.000000' AND NOW()"); 
}elseif($_GET['type'] == 'poz'){
	$result= mysqli_query($connection, "SELECT id, screen_name, text FROM tweets WHERE emo = 1 AND created_at BETWEEN '2020-04-30 00:00:00.000000' AND NOW()"); 
}elseif($_GET['type'] == 'neg'){
	$result= mysqli_query($connection, "SELECT id, screen_name, text FROM tweets WHERE emo = -1 AND created_at BETWEEN '2020-04-30 00:00:00.000000' AND NOW()"); 
}else{
	if($set == 'train'){
		$query = "SELECT emo, id, screen_name, text FROM tweets WHERE emo IS NOT NULL AND created_at BETWEEN '2020-04-30 00:00:00.000000' AND NOW() AND id NOT IN ('".implode("','",$testIDs)."')"; 
	}else{
		$query = "SELECT emo, id, screen_name, text FROM tweets WHERE emo IS NOT NULL AND created_at BETWEEN '2020-04-30 00:00:00.000000' AND NOW() AND id IN ('".implode("','",$testIDs)."')"; 
	}
	
	$result = mysqli_query($connection, $query);
	
	echo "[</br>";
	while($p=mysqli_fetch_array($result)){
		switch($p["emo"]){
			case -1:
				$sentiment = "neg";
				break;
			case 0:
				$sentiment = "neu";
				break;
			case 1:
				$sentiment = "pos";
				break;
		}
		if(isset($_GET['compact'])){
			echo "{";
			echo '"sentiment":"'.$sentiment.'",';
			echo '"screen_name":"'.$p["screen_name"].'",';
			echo '"tweet_id":"'.$p["id"].'",';
			echo '"tweet_text":"'.json_replacements(replacements($p["text"])).'"';
			echo "},</br>";
		}else{
			echo "&nbsp;&nbsp;&nbsp;{</br>";
			echo '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"sentiment":"'.$sentiment.'",</br>';
			echo '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"screen_name":"'.$p["screen_name"].'",</br>';
			echo '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"tweet_id":"'.$p["id"].'",</br>';
			echo '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"tweet_text":"'.json_replacements(replacements($p["text"])).'"</br>';
			echo "&nbsp;&nbsp;&nbsp;},</br>";
		}
		
	}
	echo "]";
	die;
}

while($p=mysqli_fetch_array($result)){
	echo $p["id"]."\t".$p["screen_name"]."\t".replacements($p["text"])."\n";
}
		
function json_replacements($text){
	$text = str_replace('\\', '\\\\"', $text);
	$text = str_replace('"', '\"', $text);
	return $text;
}
function replacements($text){
	for ($i=0; $i<10; $i++){
		$text = str_replace("\r\n", " ", $text);
		$text = str_replace("  ", " ", $text);
	}
	for ($i=0; $i<10; $i++){
		$text = str_replace("\n", " ", $text);
		$text = str_replace("  ", " ", $text);
	}
	for ($i=0; $i<10; $i++){
		$text = str_replace("  ", " ", $text);
	}
	
	return $text;
}